(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{13:function(e,t,a){e.exports=a(29)},21:function(e,t,a){},22:function(e,t,a){},23:function(e,t,a){},24:function(e,t,a){},29:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),r=a(11),o=a.n(r);a(21),a(22),a(23);var i=e=>{var t;let{createVillager:a,villagers:r,setResources:o}=e;const[i,c]=Object(n.useState)(null);return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"villagerListTitle"},l.a.createElement("h1",null,"Villagers")),l.a.createElement("div",null,l.a.createElement("div",{className:"villagerListGroup"},l.a.createElement("ul",{className:"villagerListElements"},r&&r.map(e=>l.a.createElement("li",{key:e.id,onClick:t=>(function(e,t){c(t)})(0,e)},l.a.createElement("span",null,e.name)))),l.a.createElement("div",{className:"villagerListDetails"},i&&l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"villagerListDetails-Name"},l.a.createElement("h4",null,i.name)),l.a.createElement("div",{className:"villagerListDetails-Job"},i.job||"Unemployed"),l.a.createElement("div",{className:"villagerListDetails-Inventory"},l.a.createElement("ul",{className:"villagerListDetails-Inventory-Inventory-List"},null===i||void 0===i?void 0:null===(t=i.inventory)||void 0===t?void 0:t.map(e=>l.a.createElement("li",{className:"villagerListDetails-Inventory-Inventory-Item",key:e.id},e.name," ",e.quantity,"gem"===e.name&&l.a.createElement("button",{onClick:()=>((e,t)=>{console.log(`Trying to sell ${t} form ${e.name}`);const a=e.inventory.findIndex(e=>e.name===t),n=10*e.inventory[a].quantity;e.inventory[a].quantity=0,o(e=>e.map(e=>"gold"===e.type?{...e,quantity:e.quantity+n}:e))})(i,e.name)},"Sell All Gems"))))))))))};var c=e=>{let{village:t}=e;return t?l.a.createElement(l.a.Fragment,null,l.a.createElement("div",null,l.a.createElement("div",{className:"header"},l.a.createElement("div",{className:"home"},l.a.createElement("h3",null,"\ud83d\udc65",t.villagePopulation,"/",t.villagePopulationLimit)),l.a.createElement("div",{className:"title"},l.a.createElement("h3",null,"Small Town")),l.a.createElement("div",{className:"contacts"},l.a.createElement("h3",null,t.villageName))))):l.a.createElement("div",null,"Loading village...")};var s=e=>{let{cityResources:t,maxResources:a}=e;const n={gold:"\ud83e\ude99",food:"\ud83c\udf4e",wood:"\ud83e\udeb5",stone:"\ud83e\udea8"};return l.a.createElement(l.a.Fragment,null,t&&t.map((e,t)=>l.a.createElement("div",{key:t,className:`eventList-ResourceControlHud-${e.type.charAt(0).toUpperCase()+e.type.slice(1)}`},l.a.createElement("span",null,n[e.type],": ",e.quantity,"/",a))))};a(24);var u=e=>{let{grid:t,setGrid:a,cityResources:r,setResources:o,villagers:i,setVillagers:c,setVillage:s,createVillager:u,maxResources:m,setMaxResources:d,maxResourcesByLevel:g,villagersRef:y}=e;const[v,f]=Object(n.useState)(null),[p,E]=Object(n.useState)({}),b=Object(n.useRef)(!1),[h,w]=Object(n.useState)(!1),k=Object(n.useRef)({}),[j,N]=Object(n.useState)(!1),[q,O]=Object(n.useState)([]),[S,C]=Object(n.useState)([{reference:"Town Hall",icon:"\ud83c\udfdb\ufe0f",cost:[{type:"gold",quantity:10},{type:"wood",quantity:10},{type:"stone",quantity:10}],level:1},{reference:"House",icon:"\ud83c\udfe0",cost:[{type:"gold",quantity:20},{type:"wood",quantity:20},{type:"stone",quantity:20}]},{reference:"Lumberjack",icon:"\ud83e\ude93",cost:[{type:"gold",quantity:10},{type:"wood",quantity:10},{type:"stone",quantity:0}],resourceGainPerWorker:2,foodConsumptionPerWorker:1},{reference:"Miner",icon:"\u26cf\ufe0f",cost:[{type:"gold",quantity:10},{type:"wood",quantity:10},{type:"stone",quantity:10}],resourceGainPerWorker:2,foodConsumptionPerWorker:1},{reference:"Farm",icon:"\ud83c\udf3e",cost:[{type:"gold",quantity:5},{type:"wood",quantity:10},{type:"stone",quantity:5}],resourceGainPerWorker:2,foodConsumptionPerWorker:1}]);const L=e=>e.every(e=>{let{type:t,quantity:a}=e;const n=r.find(e=>e.type===t);return n&&n.quantity>=a}),R=e=>{const t=r.map(t=>{const a=e.find(e=>e.type===t.type);return a?{...t,quantity:t.quantity-a.quantity}:t});o(t)},P=()=>{b.current=!0;let e=Date.now();const t=()=>{if(!b.current)return;const a=Date.now();(a-e)/1e3>=1&&(Object.entries(k.current).forEach(e=>{let[t,a]=e;const n=S.find(e=>e.reference===t);if(!n)return;let l=[];if(y.current.forEach(e=>{e.job&&l.push(e)}),l.length>0)switch(M(l),t){case"Lumberjack":I("wood",l.length*n.resourceGainPerWorker),I("food",l.length*-n.foodConsumptionPerWorker);break;case"Miner":I("stone",l.length*n.resourceGainPerWorker),I("food",l.length*-n.foodConsumptionPerWorker);break;case"Farm":I("food",l.length*n.resourceGainPerWorker),I("food",l.length*-n.foodConsumptionPerWorker)}}),e=a),requestAnimationFrame(t)};t()},B=(e,n)=>{const l=t[e][n];"empty"===l.type?((e,n)=>{if(v)if("empty"===t[e][n].type){if("Town Hall"===v.reference){if(h)return;w(!0)}L(v.cost)?(R(v.cost),a(t=>{const a=[...t];return a[e][n]={type:v.reference,id:`${e}-${n}`,workers:[],coordinates:{row:e,col:n}},a}),"House"===v.reference&&(s(e=>({...e,villagePopulationLimit:e.villagePopulationLimit+2})),u(i.length+1),u(i.length+2)),k.current[v.reference]=(k.current[v.reference]||0)+1,b.current||P()):alert("Not enough resources to place this building!")}else alert("This cell is already occupied!");else alert("No building selected!")})(e,n):E(l)};const I=(e,t)=>{const a=m||g*S.find(e=>"Town Hall"===e.reference).level;o(n=>n.map(n=>{if(n.type===e){const e=n.quantity+t;return{...n,quantity:Math.min(e,a)}}return n}))};const M=e=>{e.forEach(e=>{if("Miner"===e.job&&Math.random()<.9){const t=y.current.findIndex(t=>t.id===e.id);if(-1!==t){const e=y.current[t],a=e.inventory.findIndex(e=>"gem"===e.name);-1!==a?e.inventory[a].quantity+=1:e.inventory.push({name:"gem",quantity:1})}}}),c([...y.current])};const H=()=>N(!1);return Object(n.useEffect)(()=>{if(!function(e){if(!e)return!0;const t=e.find(e=>"food"===e.type);return t&&t.quantity>0}(r))return alert("Game Over"),void(b.current=!1);(function(e){if(!e)return!1;const t=e.find(e=>"gold"===e.type);return t&&t.quantity>=5e3})(r)&&(b.current=!1)},[r]),Object(n.useEffect)(()=>()=>{b.current=!1},[]),l.a.createElement(l.a.Fragment,null,j&&l.a.createElement("div",{className:"modal-overlay"},l.a.createElement("div",{className:"modal-content"},l.a.createElement("h2",null,"Hire a Villager"),l.a.createElement("ul",null,q.map(e=>l.a.createElement("li",{key:e.id},e.name," (",e.gender,")",l.a.createElement("button",{onClick:()=>(e=>{if(c(t=>{const a=t.map(t=>t.id===e?{...t,job:p.type,assignedBuildingID:p.id}:t);return y.current=a,a}),console.log("Updated villagers via ref:",y.current),p.coordinates){const{row:t,col:n}=p.coordinates;a(a=>{const l=[...a],r=l[t][n];return r.workers||(r.workers=[]),r.workers.includes(e)||r.workers.push(e),l})}else console.error("Building coordinates are missing");alert(`Villager ${e} Hired`),H()})(e.id)},"Hire")))),l.a.createElement("button",{onClick:H,className:"close-button"},"Close"))),l.a.createElement("div",{className:"game-BuildingMenu"},S.map(e=>{let{reference:t,icon:a,cost:n}=e;return l.a.createElement("div",{key:t,className:`game-BuildingMenu-Icon ${v===t?"selected":""}`,onClick:e=>(function(e){const t=S.find(t=>t.reference===e);t&&L(t.cost)&&f(t)})(t),"data-reference":`${t}`},l.a.createElement("span",null,a))})),l.a.createElement("div",{className:"grid"},t.map((e,t)=>l.a.createElement("div",{key:`row-${t}`,className:"row"},e.map((e,a)=>{var n;return l.a.createElement("div",{key:`${t}-${a}`,className:`cell ${"empty"!==e.type?"occupied":"empty"}`,onClick:()=>B(t,a)},(null===(n=S.find(t=>{let{reference:a}=t;return a===e.type}))||void 0===n?void 0:n.icon)||"")})))),l.a.createElement("div",{className:"game-SelectedBuilding"},p&&p.type?l.a.createElement("div",{className:"game-SelectedBuilding-Content"},l.a.createElement("div",{className:"game-SelectedBuilding-Content-Title"},p.type),"House"!==p.type&&"Town Hall"!==p.type?l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"game-SelectedBuilding-Content-Buttons"},l.a.createElement("button",{onClick:()=>{O(i.filter(e=>null===e.job)),N(!0)}},"Hire a Villager")),l.a.createElement("div",{className:"game-SelectedBuilding-Content-Workers"},l.a.createElement("h3",null,"Assigned Workers"),p.workers&&p.workers.length>0?l.a.createElement("ul",null,p.workers.map(e=>{const t=i.find(t=>t.id===e);return l.a.createElement("li",{key:e},(null===t||void 0===t?void 0:t.name)||"Unknown Worker")})):l.a.createElement("p",null,"No workers assigned"))):"Town Hall"===p.type?l.a.createElement("div",{className:"game-SelectedBuilding-Content-TownHall"},l.a.createElement("span",null," - Level ",S.find(e=>"Town Hall"===e.reference).level),l.a.createElement("button",{onClick:function(){const e=[...S],t=e.find(e=>"Town Hall"===e.reference);if(!t)return void console.log("Town Hall not found");const a=[{type:"gold",quantity:m},{type:"wood",quantity:m},{type:"stone",quantity:m}];L(a)?(console.log("Can afford"),R(a),t.level+=1,d(t.level*g),C(e)):console.log("Can't afford")}},"Upgrade level"),l.a.createElement("p",null,"Cost ",m)):l.a.createElement("p",null,"+2 Villagers")):null))};var m=()=>{const[e,t]=Object(n.useState)(0),[a,r]=Object(n.useState)(0),[o,i]=Object(n.useState)(0);return Object(n.useEffect)(()=>{const e=setInterval(()=>{t(e=>60===e?(r(e=>60===e?(i(e=>e+1),0):e+1),0):e+1)},1e3);return()=>clearInterval(e)},[]),l.a.createElement("div",{className:"stopwatch"},l.a.createElement("div",{className:"display"},function(){let t=String(e).padStart(2,"0"),n=String(a).padStart(2,"0"),r=String(o).padStart(2,"0");return l.a.createElement("div",null,r,":",n,":",t)}()))},d=a(5),g=a(12);const y=Object(g.a)({apiKey:"AIzaSyDnrGEbzBojCAXl9NA94bCQAt8Zt-zm8Pw",authDomain:"small-town-422d3.firebaseapp.com",projectId:"small-town-422d3",storageBucket:"small-town-422d3.firebasestorage.app",messagingSenderId:"1028795159542",appId:"1:1028795159542:web:03f8d31e275a9ad581add7"}),v=Object(d.c)(y);function f(){const[e,t]=Object(n.useState)(Date.now()),[a,r]=Object(n.useState)(!1),[o,g]=Object(n.useState)([]),y=Object(d.a)(v,"gameData","elapsedTimes"),[f,p]=Object(n.useState)(null),[E,b]=Object(n.useState)([]),[h,w]=Object(n.useState)(null),[k,j]=Object(n.useState)(),N=Object(n.useRef)(E),q=["John","Mark","Carl"],O=["Charlotte","Amelia","Violet"],[S,C]=Object(n.useState)(Array.from({length:18},()=>Array.from({length:18},()=>({type:"empty"})))),L=function(e){let t,a=Math.floor(2*Math.random());0===a?(t=q[Math.floor(Math.random()*q.length)],a="M"):1===a?(t=O[Math.floor(Math.random()*O.length)],a="F"):console.log(a);const n={id:e||E.length+1,name:t,yearOfBirth:2e3,job:null,gender:a,inventory:[]};console.log("Created new Villager",n),b(e=>{const t=[...e,n];return N.current=t,t}),p(e=>({...e,villagePopulation:e.villagePopulation+1}))};Object(n.useEffect)(()=>{!function(e){p({villageName:"My Village",villageList:E,villagePopulation:0,villagePopulationLimit:e,resources:h})}(2),b([{id:0,name:"John",yearOfBirth:2e3,job:null,gender:"M",inventory:[]},{id:1,name:"Sarah",yearOfBirth:2e3,job:null,gender:"F",inventory:[]}]),p(e=>({...e,villagePopulation:E.length+2})),function(){console.log("Resource Initializer");w([{type:"gold",quantity:50},{type:"food",quantity:50},{type:"wood",quantity:50},{type:"stone",quantity:50}])}(),j(1e3)},[]),Object(n.useEffect)(()=>{(async()=>{try{const t=await Object(d.b)(y);t.exists()?g(t.data().times||[]):console.log("No times found in Firestore.")}catch(e){console.error("Error fetching times from Firestore:",e)}})();const e=Object(d.d)(y,e=>{e.exists()&&g(e.data().times||[])});return()=>e()},[]);return Object(n.useEffect)(()=>{if(h){const n=h.find(e=>"gold"===e.type);if(n&&n.quantity>=5e3){if(!a){(async e=>{try{const a=await Object(d.b)(y);a.exists()?await Object(d.f)(y,{times:[...a.data().times,e]}):await Object(d.e)(y,{times:[e]}),console.log("Time saved:",e)}catch(t){console.error("Error saving elapsed time:",t)}})((Date.now()-e)/1e3),t(Date.now()),r(!0)}}else r(!1)}},[h]),l.a.createElement("main",null,l.a.createElement("header",null,l.a.createElement(c,{village:f})),l.a.createElement("body",null,l.a.createElement("div",{className:"content"},l.a.createElement("div",{className:"villagerListApp"},l.a.createElement(i,{createVillager:L,villagers:E,setResources:w})),l.a.createElement("div",{className:"game"},l.a.createElement(u,{grid:S,setGrid:C,cityResources:h,setResources:w,villagers:E,setVillagers:b,setVillage:p,createVillager:L,maxResources:k,setMaxResources:j,maxResourcesByLevel:1e3,villagersRef:N})),l.a.createElement("div",{className:"eventList"},l.a.createElement("div",{className:"eventList-Calendar"},l.a.createElement(m,null)),l.a.createElement("div",{className:"eventList-ResourceControlHud"},l.a.createElement(s,{cityResources:h,maxResources:k})),l.a.createElement("div",{className:"eventList-Listing"},l.a.createElement("h3",null,"Elapsed Times (seconds):"),l.a.createElement("ul",null,o.map((e,t)=>l.a.createElement("li",{key:t},"Time ",t+1,": ",e,"s"))))))))}o.a.createRoot(document.getElementById("root")).render(l.a.createElement(f,null))}},[[13,1,2]]]);
//# sourceMappingURL=main.f8516fcc.chunk.js.map